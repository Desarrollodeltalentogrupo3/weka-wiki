<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/Waikato/weka-wiki/lib_svm/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Lib svm - Weka Wiki</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lib svm";
        var mkdocs_page_input_path = "lib_svm.md";
        var mkdocs_page_url = "/Waikato/weka-wiki/lib_svm/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Weka Wiki
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../downloading_weka/">Downloading and installing Weka</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../requirements/">Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../documentation/">Documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting_help/">Getting help</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../citing_weka/">Citing Weka</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../literature/">Literature</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../development/">Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../history/">History</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../not_so_faq/">Not so FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../using_the_api/">Using the API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../extending_weka/">Extending Weka</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../formats_and_processing/arff/">ARFF Format</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../primer/">Primer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../visualization_articles/">Visualization Articles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../properties_file/">Properties File</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../packages/">Packages</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../experimenter/experimenter/">Experimenter</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Weka Wiki</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Lib svm</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="description">Description<a class="headerlink" href="#description" title="Permanent link">#</a></h3>
<p>Wrapper class for the <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">LibSVM</a> library by Chih-Chung Chang and Chih-Jen Lin. The original wrapper, named WLSVM, was developed by Yasser EL-Manzalawy. The current version is complete rewrite of the wrapper, using <a href="http://java.sun.com/docs/books/tutorial/reflect/">Reflection</a> in order to avoid compilation errors, in case the <code>libsvm.jar</code> is not in the <a href="../classpath/">CLASSPATH</a>.</p>
<p><strong>Important note:</strong>
From WEKA &gt;= 3.7.2 installation and use of LibSVM in WEKA has been simplified by the creation of a <a href="https://weka.sourceforge.io/doc.packages/LibSVM/weka/classifiers/functions/LibSVM.html">LibSVM</a> package that can be installed using either the graphical or command line <a href="../packages/manager/">package manager</a>.</p>
<h3 id="reference-weka-368"><strong>Reference (Weka &lt;=</strong> <strong>3.6.8)</strong><a class="headerlink" href="#reference-weka-368" title="Permanent link">#</a></h3>
<ul>
<li><a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">LibSVM</a></li>
<li><a href="https://perun.pmf.uns.ac.rs/radovanovic/dmsem/cd/install/LIBSVM/WLSVM/wlsvm.htm">WLSVM</a></li>
</ul>
<h3 id="package">Package<a class="headerlink" href="#package" title="Permanent link">#</a></h3>
<p><code>weka.classifiers.functions</code></p>
<h3 id="download">Download<a class="headerlink" href="#download" title="Permanent link">#</a></h3>
<p>The wrapper class is part of WEKA since version 3.5.2. But <em>LibSVM</em>, as a third-party-tool needs to be downloaded separately. It is recommended to upgrade to a post-3.5.3 version (or <a href="../git/">git</a>) for bug-fixes and extensions (contains now the <code>distributionForInstance</code> method).</p>
<h3 id="classpath">CLASSPATH<a class="headerlink" href="#classpath" title="Permanent link">#</a></h3>
<p>Add the <code>libsvm.jar</code> from the LibSVM distribution to your <a href="../classpath/">CLASSPATH</a> to make it available.</p>
<p><strong>Note:</strong> Do NOT start WEKA then with <code>java -jar weka.jar</code>. The <strong>-jar</strong> option <em>overwrites</em> the <a href="../classpath/">CLASSPATH</a>, not augments it (a very common trap to fall into). Instead use something like this on Linux:</p>
<pre><code class="language-bash"> java -classpath $CLASSPATH:weka.jar:libsvm.jar weka.gui.GUIChooser
</code></pre>
<p>or this on Win32 (if you're starting it from commandline):</p>
<pre><code class="language-bash"> java -classpath &quot;%CLASSPATH%;weka.jar;libsvm.jar&quot; weka.gui.GUIChooser
</code></pre>
<p>If you're starting WEKA from the Start Menu on Windows, you'll have to add the <code>libsvm.jar</code> to your <code>CLASSPATH</code> environment variable. The following steps are for <em>Windows XP</em> (unfortunately, the GUI changes among the different Windows versions):</p>
<ul>
<li>right-click on <em>My Computer</em> and select <em>Properties</em> from the menu</li>
<li>choose the <em>Advanced</em> tab and click on <em>Environment variables</em> at the bottom</li>
<li>either add or modify a variable called <code>CLASSPATH</code> and add the <code>libsvm.jar</code> with full path to it</li>
</ul>
<h3 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">#</a></h3>
<ul>
<li><strong>LibSVM classes not in CLASSPATH!</strong><ul>
<li>Check whether the <code>libsvm.jar</code> is really in your CLASSPATH. Execute the following command in the <strong>SimpleCLI</strong>:</li>
</ul>
</li>
</ul>
<blockquote>
<blockquote>
<p><code>java weka.core.SystemInfo</code></p>
<p>The property <code>java.class.path</code> must list the <code>libsvm.jar</code>. If it is listed, check whether the path is correct.</p>
<p>If you're on Windows and you find <code>%CLASSPATH%</code> there, see next bullet point to fix this.</p>
</blockquote>
</blockquote>
<ul>
<li>On Windows, if you added the <code>libsvm.jar</code> to your CLASSPATH environment variable, it can still happen that WEKA pops up the error message that the LibSVM classes are not in your CLASSPATH. This can happen where the <a href="http://support.microsoft.com/kb/329308"><code>%CLASSPATH%</code> does not get expanded</a> to its actual value in starting up WEKA. You can inspect your current CLASSPATH with which WEKA got started up with the <strong>SimpleCLI</strong> (see previous bullet point). If <code>%CLASSPATH%</code> is listed there, your system has the same problem. You can also explicitly add a .jar file to <code>RunWeka.ini</code>.<blockquote>
<blockquote>
<p><strong>Note:</strong> backslashes have to be escaped, not only once, but twice (they get interpreted by Java twice!). In other words, instead of <em>one</em> you have to use <em>four</em>: 
<code>C:\some\where</code> then turns into <code>C:\\\\some\\\\where</code>.</p>
</blockquote>
</blockquote>
</li>
</ul>
<h3 id="issues-with-libsvmjar-that-were-discussed-on-the-weka-list-in-april-2007-and-may-no-longer-be-relevant">Issues with libsvm.jar that were discussed on the Weka list in April 2007 (and may no longer be relevant)<a class="headerlink" href="#issues-with-libsvmjar-that-were-discussed-on-the-weka-list-in-april-2007-and-may-no-longer-be-relevant" title="Permanent link">#</a></h3>
<p>The following changes were not incorporated in WEKA, since it also means modifying the LibSVM Java code, which (I think) is autogenerated from the C code. The authors of LibSVM might have to consider that update. It's left to the reader to incorporate these changes.</p>
<h4 id="libsvmsvm-uses-mathrandom">libsvm.svm uses Math.random<a class="headerlink" href="#libsvmsvm-uses-mathrandom" title="Permanent link">#</a></h4>
<p>libsvm.svm calls Math.random so the model it returns is usually different for the same training set and svm parameters over time.</p>
<p>Obviously, if you call libsvm.svm from weka.classifiers.functions.libsvm, and you call it again from libsvm.svm_train, the results are also different.</p>
<p>You can use libsvm.svm_save_model to record the svms into files, and then compare the model file from WEKA LibSVM with the model file from libsvm.svm_predict. Then you can see that ProbA values use to be different.</p>
<p>WEKA experimenter is based on using always the same random sequences in order to repeat experiments with the same results. So, I'm afraid some important design changes are required on libsvm.jar and weka.classifiers.functions.libsvm.class to keep such behaviour. We made a quick fix adding an static Random attribute to libsvm.svm class:</p>
<pre><code class="language-java"> static java.util.Random ranGen = new Random(0);
</code></pre>
<p>We have changed all Math.random() invokations to ranGen.nextdouble(). Then we have obtained the same svm from weka LibSVM than from LibSVM train_svm.</p>
<p>However, WEKA accuracy results on primary_tumor data were still worse, so there's something wrong when weka uses the svm model at testing step.</p>
<h4 id="classes-without-instances">Classes without instances<a class="headerlink" href="#classes-without-instances" title="Permanent link">#</a></h4>
<p>ARFF format provides some meta-information (i.e. attributes name and type, set of possible values for nominal attributes), but LibSVM format doesn't. So if there are classes in the dataset with zero occurrences through all the instances, LibSVM thinks that these classes don't exist whereas WEKA knows they exist.</p>
<p>For example, there is a class in primary tumor dataset that never appears. When WEKA experimenter makes testing, it calls to:</p>
<pre><code class="language-java"> public static double svm_predict_probability(svm_model model, svm_node[] x, double[] prob_estimates)
</code></pre>
<p>passing the array prob_estimates plenty of zeros (array cells are initialized to zero). The size of the array is equal to the number of classes (= 22). On the other hand, if this method is invoked from libsvm.svm_predict, the class that never appears is ignored, so the array dimension is now equal to 21.</p>
<p>So accuracy results are different depending on origin of svm_predict_probability method invocation. I think that better results are obtained if classes without instances are ignored, but I don't know if it is very fair. In fact, accuracies from weka.libsvm and from libsvm.predict_svm seem to be the same if the class that never appears is removed from ARFF file.</p>
<p>Note that this problem only appears when testing, because the training code uses always the svm_group_classes method to compute the number of classes, so Instances.numClasses() value is never used for training. Moreover, maybe the mismatch between the training number of classes and the testing number of classes is the reason behind worse accuracy results when svm_predict_probability invocation is made from WEKA, but I haven't proved it yet.</p>
<p>Note that this problem does also happen when you have a class with less examples than the number of folds. For some folds, the class will not have training examples.</p>
<p>We also made a quick fix for this problem:</p>
<ul>
<li>Add this public method to libsvm.svm_model class<blockquote>
<p><code>public int getNr_class(){return nr_class;}</code></p>
</blockquote>
</li>
<li>Make the following changes into <code>distributionforInstance</code> Method at <code>weka.classifiers.functions.LibSVM</code><blockquote>
<p>First line of the method:</p>
</blockquote>
</li>
</ul>
<pre><code class="language-java"> int[] labels = new int[instance.numClasses()];
</code></pre>
<blockquote>
<p>could be changed to</p>
</blockquote>
<pre><code class="language-java"> int[] labels = new int[((svm_model) m_Model).getNr_class()];
</code></pre>
<blockquote>
<p>Last line in "if(m_ProbablityEstimates)" block:</p>
</blockquote>
<pre><code class="language-java"> prob_estimates = new double[instance.numClasses()];
</code></pre>
<blockquote>
<p>could be changed to</p>
</blockquote>
<pre><code class="language-java"> prob_estimates = new double[((svm_model) m_Model).getNr_class()];
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
